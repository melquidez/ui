#!/bin/env bash

# TODO: Rename `schemes` directory to `themes`?

cd ~/ui

DIR="schemes/*/"
DIRS=($DIR)
FIRST=`echo "${DIRS[@]:0:1}" | awk -F'/' '{print $2}' -`

schemes () {
  for dir in $DIR; do
    dir=`echo $dir | awk -F'/' '{print $2}' -`
    echo "- $dir"
  done
}

containsElement () {
  local e

  for e in "${@:2}"; do
    [[ "$e" == "$1" ]] &&
      return 0
  done

  return 1
}

ask () {
  read -p "Choose a colorscheme. Available options are:

$(schemes)

($FIRST) > " choice

  if [[ -z "$choice" ]]; then
    stowlink ${FIRST}
    return 0
  fi

  check="schemes/${choice}/"
  containsElement "${check}" "${DIRS[@]}"

  if [[ $? -eq 1 ]]; then
    echo -e "\nERROR: There is no theme '${choice}', try again!\n"
    ask
  else
    stowlink ${choice}
    return 0
  fi
}

stowlink () {
  for dir in $DIR; do
    dir=`echo $dir | awk -F'/' '{print $2}' -`
    stow -t ~ -d schemes -D $dir
  done

  mkdir -pv ~/.backup
  mkdir -pv ~/.cache/mutt
  mkdir -pv ~/.config/bspwm
  mkdir -pv ~/.config/dzen2
  mkdir -pv ~/.config/mpd
  mkdir -pv ~/.config/mpv
  mkdir -pv ~/.config/mutt
  mkdir -pv ~/.config/sxhkd
  mkdir -pv ~/.config/zathura
  mkdir -pv ~/.emacs.d
  mkdir -pv ~/.emacs.d/kb
  mkdir -pv ~/.pentadactyl/colors
  mkdir -pv ~/.urxvt
  mkdir -pv ~/.vim/autoload
  mkdir -pv ~/.vim/plugged

  stow -t ~ -d schemes $1
}

if [ $# -eq 0 ]; then
  ask
else
  check="schemes/$1/"
  containsElement "${check}" "${DIRS[@]}"

  if [[ $? -eq 1 ]]; then
    echo -e "ERROR: There is no theme '$1'!\n"
    ask
  else
    stowlink $1
  fi
fi
