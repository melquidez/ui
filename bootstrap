#!/bin/bash

cd ~/ui

IGNORE=(
  "bin/"
  "dmenu/"
  "docs/"
  "dzen2/"
  "firefox/"
  "guix/"
  "misc/"
  "pacman/"
  "themes/"
  "vendor/"
  "zathura/"
)

MAKEDIRS=true

DIRS="
  ~/.backup
  ~/.cache/mutt
  ~/.config/bspwm
  ~/.config/dzen2
  ~/.config/mpd
  ~/.config/mpv
  ~/.config/mutt
  ~/.config/sxhkd
  ~/.config/zathura
  ~/.emacs.d
  ~/.pentadactyl/colors
  ~/.urxvt
  ~/.vim/autoload
  ~/.vim/plugged
"

containsElement () {
  local e

  for e in "${@:2}"; do
    [[ "$e" == "$1" ]] &&
      return 0
  done

  return 1
}

if [ "$MAKEDIRS" = true ]; then
  for dir in $DIRS; do
    mkdir -pv "${dir}"
  done
fi

for dir in */ ; do
  containsElement "${dir}" "${IGNORE[@]}"

  if [[ $? -eq 1 ]]; then
    stow "${dir}"
  fi
done

# TODO: Also mkdir ~/gh and clone some appropriate repos. These don't have to be
# submodules because they are developed by me. This ties into giving directory
# structure information.

# TODO: Run `dl-hg-packages` script somewhere here.
# TODO: Run vim plugins init script somewhere here.

git submodule init
git submodule update

ln -s ~/ui/vendor/vim/vim-plug/plug.vim ~/.vim/autoload/plug.vim

sudo rm -vi /etc/pacman.conf
sudo stow -t / pacman
sudo stow -t / zathura

./bin/chue
